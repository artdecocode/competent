{
"version":3,
"file":"compile/competent.js",
"lineCount":473,
"mappings":"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",
"sources":["node_modules/@depack/render/src/util.js","node_modules/@depack/render/src/lib/index.js","node_modules/@depack/render/src/index.js","node_modules/mismatch/src/index.js","node_modules/rexml/src/lib/res-simple.js","node_modules/rexml/src/index.js","node_modules/rexml/src/lib/index.js","node_modules/stream/index.js","node_modules/restream/src/lib/index.js","node_modules/os/index.js","node_modules/@artdeco/clean-stack/src/index.js","node_modules/erotic/src/lib.js","node_modules/erotic/src/callback.js","node_modules/erotic/src/index.js","node_modules/catchment/src/lib/index.js","node_modules/catchment/src/index.js","node_modules/restream/src/Replaceable.js","src/make-comps.js","src/lib/make-io.js","src/depack.js","src/index.js","src/lib/index.js"],
"sourcesContent":["// DOM properties that should NOT have \"px\" added when numeric\nexport const IS_NON_DIMENSIONAL = /acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i\n\nexport let encodeEntities = s => `${s}`\n  .replace(/&/g, '&amp;')\n  .replace(/</g, '&lt;')\n  .replace(/>/g, '&gt;')\n  .replace(/\"/g, '&quot;')\n\nexport let indent = (s, char) => `${s}`.replace(/(\\n+)/g, '$1' + (char || '\\t'))\n\nexport let isLargeString = (s, length = 40, ignoreLines = false) => (`${s}`.length>length || (!ignoreLines && `${s}`.indexOf('\\n')!=-1) || `${s}`.indexOf('<')!==-1)\n\nconst JS_TO_CSS = {}\n\n/**\n * Convert an Object style to a CSSText string.\n * @param {!Object} s\n */\nexport function styleObjToCss(s) {\n  let str = ''\n  for (let prop in s) {\n    let val = s[prop]\n    if (val!=null) {\n      if (str) str += ' '\n      // str += jsToCss(prop);\n      str += JS_TO_CSS[prop] || (JS_TO_CSS[prop] = prop.replace(/([A-Z])/g,'-$1').toLowerCase())\n      str += ': '\n      str += val\n      if (typeof val=='number' && IS_NON_DIMENSIONAL.test(prop)===false) {\n        str += 'px'\n      }\n      str += ';'\n    }\n  }\n  return str || undefined\n}\n\n/**\n * Reconstruct Component-style `props` from a VNode.\n * Ensures default/fallback values from `defaultProps`:\n * Own-properties of `defaultProps` not present in `vnode.attributes` are added.\n * @param {!preact.VNode} vnode The VNode to get props for\n */\nexport function getNodeProps(vnode) {\n  const props = {\n    ...vnode.attributes, children: vnode.children,\n  }\n\n  let defaultProps = vnode.nodeName.defaultProps\n  if (defaultProps!==undefined) {\n    for (let i in defaultProps) {\n      if (props[i]===undefined) {\n        props[i] = defaultProps[i]\n      }\n    }\n  }\n\n  return props\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').VNode} preact.VNode\n */","import { encodeEntities, styleObjToCss } from '../util'\n\n/**\n * Maps attributes to `name=\"value\"` strings, and returns html if dangerouslySetInnerHTML is given.\n * @param {!Object<string, ?>} attributes\n * @param {string} nodeName\n * @param {Object} [props]\n * @param {boolean} [props.allAttributes=false]\n * @param {boolean} [props.xml=false]\n * @param {boolean} [props.isSvgMode=false]\n * @param {boolean} [props.sort=false]\n */\nexport const mapAttributes = (attributes, nodeName, {\n  allAttributes, xml, isSvgMode, sort, selectValue,\n} = {}) => {\n  let html\n  const attrs = Object.keys(attributes)\n  if (sort) attrs.sort()\n  const a = attrs.map((name) => {\n    let v = attributes[name]\n    if (name == 'children') return\n    if (name.match(/[\\s\\n\\\\/='\"\\0<>]/)) return\n    if (!allAttributes && ['key', 'ref'].includes(name)) return\n    if (name == 'className') {\n      if (attributes.class) return // class takes precedence\n      name = 'class'\n    } else if (name == 'htmlFor') {\n      if (attributes.for) return // class takes precedence\n      name = 'for'\n    } else if (name == 'srcSet') {\n      if (attributes.srcset) return // srcset takes precedence\n      name = 'srcset'\n    }\n    if (isSvgMode && name.match(/^xlink:?./)) {\n      name = name.toLowerCase().replace(/^xlink:?/, 'xlink:')\n    }\n    if (name == 'style' && v && typeof v == 'object') {\n      v = styleObjToCss(v)\n    }\n    if (name == 'dangerouslySetInnerHTML') {\n      html = v && v.__html // side-effect\n    } else if ((v || v===0 || v==='') && typeof v!='function') {\n      if (v===true || v==='') {\n        v = name\n        // in non-xml mode, allow boolean attributes\n        if (!xml) return name\n      }\n      let s = ''\n      if (name == 'value') {\n        if (nodeName == 'select') {\n          selectValue = v\n          return\n        } else if (nodeName == 'option' && selectValue == v) {\n          s = 'selected '\n        }\n      }\n      return `${s}${name}=\"${encodeEntities(v)}\"`\n    }\n  }).filter(Boolean)\n  return { mappedAttributes: a, html, selectValue }\n}\n\nexport const inlineElements = [\n  'a', 'abbr', 'acronym', 'audio', 'b', 'bdi', 'bdo', 'big', 'br',\n  'button', 'canvas', 'cite', 'code', 'data', 'datalist', 'del',\n  'dfn', 'em', 'embed', 'i', 'iframe', 'img', 'input', 'ins',\n  'kbd', 'label', 'map', 'mark', 'meter', 'noscript', 'object',\n  'output', 'picture', 'progress', 'q', 'ruby', 's', 'samp',\n  'slot', 'small', 'span', 'strong', 'sub',\n  'sup', 'svg', 'template', 'textarea', 'time', 'u', 'tt', 'var',\n  'video', 'wbr',\n]","import { encodeEntities, indent, isLargeString, getNodeProps } from './util'\nimport { mapAttributes, inlineElements } from './lib'\n\n// components without names, kept as a hash for later comparison to return consistent UnnamedComponentXX names.\nconst UNNAMED = []\n\nconst VOID_ELEMENTS = /^(area|base|br|col|embed|hr|img|input|link|meta|param|source|track|wbr)$/\nconst INLINE_ELEMENTS = new RegExp(`^(${inlineElements.join('|')})$`)\n\n/** Only render elements, leaving Components inline as `<ComponentName ... />`.\n * This method is just a convenience alias for `render(vnode, context, { shallow:true })`\n * @param {preact.VNode} vnode JSX VNode to render.\n * @param {!Object} [context]  Optionally pass an initial context object through the render path.\n */\nconst shallowRender = (vnode, context) => renderToString(vnode, { shallow: true }, context)\n\n// const prettyAttributeHook = (name, value, context, opts) => {\n//   let indentChar = typeof opts.pretty=='string' ? opts.pretty : '  '\n//   return `\\n${indentChar}${name}=\"${encodeEntities(value)}\"`\n// }\n\n/**\n * Render Preact JSX Components to an HTML string.\n * @param {preact.VNode} vnode JSX VNode to render.\n * @param {!_depack.RenderConfig} [config] Rendering options.\n */\nconst render = (vnode, config = {}, context = {}) => {\n  const { addDoctype, pretty } = config\n  const res = renderToString(vnode, config, context)\n  if (addDoctype) return `<!doctype html>${pretty ? '\\n': ''}${res}`\n  return res\n}\n\n/** Render Preact JSX + Components to an HTML string.\n * @param {preact.VNode|boolean|number|string|undefined} vnode\n * @param {!_depack.RenderConfig} [opts]\n * @param {!Object} [context]\n * @param {boolean} [inner]\n * @param {boolean} [isSvgMode]\n * @param {string} [selectValue] Used to set the value of options via select's value `attribute`.\n */\nfunction renderToString(\n  vnode, opts = {}, context = {}, inner = false, isSvgMode = false, selectValue,\n) {\n  if (vnode==null || typeof vnode=='boolean') {\n    return ''\n  }\n\n  const {\n    pretty = false,\n    shallow = false,\n    renderRootComponent = false,\n    shallowHighOrder = false,\n    sortAttributes,\n    allAttributes,\n    xml,\n    initialPadding = 0,\n    closeVoidTags = false,\n  } = opts\n\n  let { lineLength = 40 } = opts\n  lineLength -= initialPadding\n\n  let { nodeName, attributes = {} } = vnode\n\n  const noPretty = ['textarea', 'pre'].includes(nodeName)\n  const ip = ' '.repeat(initialPadding)\n\n  const indentChar = typeof pretty == 'string' ? pretty :\n    `  ${ip}`\n\n  // #text nodes\n  if (typeof vnode!='object' && !nodeName) {\n    return encodeEntities(vnode)\n  }\n\n  // components\n  if (typeof nodeName=='function') {\n    // nodeName = /** @type {!Function} */ (nodeName)\n    if (shallow && (inner || !renderRootComponent)) {\n      nodeName = getComponentName(nodeName)\n    }\n    else {\n      let props = getNodeProps(/** @type {!preact.VNode} */ (vnode)),\n        rendered\n\n      if (!nodeName.prototype || typeof nodeName.prototype.render!='function') {\n        // stateless functional components\n        rendered = nodeName(props, context)\n      }\n      else {\n        // class-based components\n        let c = /** @type {!preact.Component} */ (new nodeName(props, context))\n        // turn off stateful re-rendering:\n        c._disable = c.__x = true\n        c.props = props\n        c.context = context\n        if (nodeName.getDerivedStateFromProps) c.state = {\n          ...c.state,\n          ...nodeName.getDerivedStateFromProps(c.props, c.state),\n        }\n        else if (c.componentWillMount) c.componentWillMount()\n        rendered = c.render(c.props, c.state, c.context)\n\n        if (c.getChildContext) {\n          context = { ...context, ...c.getChildContext() }\n        }\n      }\n\n      return renderToString(rendered, opts, context, shallowHighOrder, isSvgMode, selectValue)\n    }\n  }\n\n  // render JSX to HTML\n  let s = '', html\n\n  let mappedAttributes\n  ;({ mappedAttributes, html, selectValue } = mapAttributes(/** @type {!Object} */ (attributes), nodeName, {\n    allAttributes, xml, isSvgMode, sort: sortAttributes, selectValue,\n  }))\n\n  // account for >1 multiline attribute\n  if (pretty) {\n    const nl = `<${nodeName}`\n    let cl = nl.length\n    s = mappedAttributes.reduce((acc, current) => {\n      const newLength = cl + 1 + current.length\n      if (newLength > lineLength) {\n        cl = indentChar.length\n        return `${acc}\\n${indentChar}${current}`\n      }\n      cl = newLength\n      return `${acc} ${current}`\n    }, '')\n  } else {\n    s = mappedAttributes.length ? ' ' + mappedAttributes.join(' ') : ''\n  }\n\n  s = `<${nodeName}${s}>`\n  if (`${nodeName}`.match(/[\\s\\n\\\\/='\"\\0<>]/)) throw s\n\n  let isVoid = `${nodeName}`.match(VOID_ELEMENTS)\n  if (closeVoidTags) {\n    if (isVoid) s = s.replace(/>$/, ' />')\n  }\n\n  let pieces = []\n  if (html) {\n    // if multiline, indent.\n    if (pretty && (isLargeString(html) || html.length + getLastLineLength(s) > lineLength)) {\n      html = '\\n' + indentChar + indent(html, indentChar)\n    }\n    s += html\n  }\n  else if (vnode.children) {\n    let hasLarge = pretty && s.includes('\\n')\n    pieces = vnode.children.map((child) => {\n      if (child==null || child===false) return\n      const childSvgMode = nodeName == 'svg' ? true : nodeName == 'foreignObject' ? false : isSvgMode\n      const ret = renderToString(child, opts, context, true, childSvgMode, selectValue)\n      if (!ret) return\n      if (pretty && ret.length + getLastLineLength(s) > lineLength)\n        hasLarge = true\n      return ret\n    }).filter(Boolean)\n\n    if (pretty && hasLarge && !noPretty) {\n      for (let i=pieces.length; i--;) {\n        pieces[i] = '\\n' + indentChar + indent(pieces[i], indentChar)\n      }\n    }\n  }\n\n  if (pieces.length) {\n    s += pieces.join('')\n  }\n  else if (xml) {\n    return s.substring(0, s.length-1) + ' />'\n  }\n\n  if (!isVoid) {\n    // inline elements should not have additional whitespace\n    // however if there were other tags inside them, that should be fine\n    const lastPiece = pieces[pieces.length - 1]\n    const isInline = `${nodeName}`.match(INLINE_ELEMENTS) && (lastPiece ? !/>$/.test(lastPiece) : true)\n    if (!isInline && !noPretty && pretty && s.includes('\\n')) s += `\\n${ip}`\n    s += `</${nodeName}>`\n  }\n\n  return s\n}\n\n/**\n * @param {!Function} component\n */\nfunction getComponentName(component) {\n  return component.displayName || component!==Function && component.name || getFallbackComponentName(component)\n}\n\n/**\n * @param {!Function} component\n */\nfunction getFallbackComponentName(component) {\n  /** @type {string} */\n  const str = Function.prototype.toString.call(component)\n\n  let name = (str.match(/^\\s*function\\s+([^( ]+)/) || '')[1]\n  if (!name) {\n    // search for an existing indexed name for the given component:\n    let index = -1\n    for (let i=UNNAMED.length; i--; ) {\n      if (UNNAMED[i]===component) {\n        index = i\n        break\n      }\n    }\n    // not found, create a new indexed name:\n    if (index<0) {\n      index = UNNAMED.push(component) - 1\n    }\n    name = `UnnamedComponent${index}`\n  }\n  return name\n}\n\nexport default render\n\nexport { shallowRender }\n\nconst getLastLineLength = (s) => {\n  const st = s.split('\\n')\n  const lastLine = st[st.length - 1]\n  return lastLine.length\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').RenderConfig} _depack.RenderConfig\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').VNode} preact.VNode\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').Component} preact.Component\n */","/**\n * Returns an array of captured groups of a regular expression as objects. Does not modify the `lastIndex` property of the regex.\n * @param {RegExp} re The regular expression used for matching.\n * @param {string} string String to find matches in.\n * @param {Array<string>} keys Keys to use to create an captured group object.\n * @param {boolean} addPositions Whether to include positions in the return.\n * @example\n *\n```js\nconst re = /(test) inside of a (string)(\\d)?/ig\nconst s = 'Test inside of a STRING1. TEST inside of a string.'\nconst keys = ['test', 'string', 'number']\nconst res = mismatch(re, s, keys)\n\n// result:\n[\n {\n   test: 'Test',\n   string: 'STRING',\n   number: '1',\n },\n {\n   test: 'TEST',\n   string: 'string',\n },\n]\n```\n */\nexport default function mismatch(re, string, keys, addPositions = false) {\n  /** @type {!Array<!Object<string, string>>} */\n  const m = []\n  string.replace(re, (match, ...args) => {\n    // remove position and input\n    const position = args[args.length - 2]\n    const start = addPositions ? { position } : {}\n    const p = args.slice(0, args.length - 2)\n    const o = p.reduce((acc, capturedGroup, i) => {\n      const key = keys[i]\n      if (!(key && capturedGroup !== undefined)) return acc\n      acc[key] = capturedGroup\n      return acc\n    }, start)\n    m.push(o)\n  })\n  return m\n}","const nameRe = /([^\\s>=/]+)/\nconst valRe = /(?:\"([\\s\\S]*?)\"|'([\\s\\S]*?)')/\n\nexport const attributeRe = new RegExp(`${nameRe.source}(?:\\\\s*=\\\\s*${valRe.source})?`, 'g')\n\n/**\n * This regex will match all attributes as a string inside of element, e.g., matching `<el attr=\"abc\" bool/>` will result in `attr=\"abc\" bool`.\n */\nexport const attributesRe = new RegExp(`(?:\\\\s+((?:${attributeRe.source}\\\\s*)*))`)\n","import mismatch from 'mismatch'\nimport { extractProps as extractPropsSpec, getPropValue } from './lib'\nimport { attributesRe } from './lib/res'\nimport { attributesRe as simple, attributeRe as simpleAttribute } from './lib/res-simple'\n\nconst execRes = (re, s) => {\n  const res = re.exec(s)\n  if (!res) return res\n  const [, ...args] = res\n  return args\n}\n\n/**\n * Extract member elements from an XML string. Numbers and booleans will be parsed into their JS types.\n * @param {string|!Array<string>} tag Which tag to extract, e.g., `div`. Can also pass an array of tags, in which case the name of the tag will also be returned.\n * @param {string} string The XML string.\n * @example\n *\n * const xml = `\n * <html>\n *   <div id=\"1\" class=\"test\" contenteditable>\n *     Hello World\n *   </div>\n * </html>\n * `\n * const [{ content, props }] = extractTag('div', xml)\n * // content: Hello World\n * // props: { id: 1, class: 'test', contenteditable: true }\n */\nconst extractTags = (tag, string) => {\n  const tags = Array.isArray(tag) ? tag : [tag]\n  const t = tags.join('|')\n  const end1 = /\\s*\\/>/\n  const end2 = />([\\s\\S]+?)?<\\/\\1>/\n  const re = new RegExp(`<(${t})${simple.source}?(?:${end1.source}|${end2.source})`, 'g')\n\n  const matches = mismatch(re, string, ['t', 'a', 'v', 'v1', 'v2', 'c'])\n  const res = matches.map(({ 't': tagName, 'a': attributes = '', 'c': content = '' }) => {\n    const attrs = attributes.replace(/\\/$/, '').trim()\n    const props = extractProps(attrs)\n    return { content, props, tag: tagName }\n  })\n  return res\n}\n\n/**\n * Extracts the properties from the attributes part of the tag and returns them as an object. It will parse values if not specified otherwise.\n * @param {string} string The attribute part of the tag.\n * @param {boolean} parseValue Whether to transform the value into its value.\n */\nexport const extractProps = (string, parseValue = true) => {\n  const m = mismatch(simpleAttribute, string, ['key', 'val', 'def', 'f'])\n  const props = m\n    .reduce((acc, { 'key': key, 'val': val }) => {\n      if (val === undefined) {\n        acc[key] = true\n        return acc\n      }\n      acc[key] = parseValue ? getPropValue(val) : val\n      return acc\n    }, {})\n  return props\n}\n\n/**\n * Extract member elements from an XML string using the complex regular expression to match attributes that confirms to the XML spec. Numbers and booleans will be parsed into their JS types.\n * @param {string} tag Which tag to extract, e.g., `div`.\n * @param {string} string The XML string.\n * @example\n *\n * const xml = `\n<html>\n  <div id=\"1\" class=\"test\" contenteditable>\n    Hello World\n  </div>\n</html>\n`\n * const [{ content, props }] = extractTag('div', xml)\n * // content: Hello World\n * // props: { id: 1, class: 'test', contenteditable: true }\n */\nexport const extractTagsSpec = (tag, string) => {\n  const end1 = /\\s*\\/>/\n  const end2 = new RegExp(`>([\\\\s\\\\S]+?)?</${tag}>`)\n  const re = new RegExp(`<${tag}${attributesRe.source}?(?:${end1.source}|${end2.source})`, 'gu')\n  const r = []\n\n  let t\n  while ((t = execRes(re, string))) {\n    if (!t.length) continue\n    const [_p = '', _c = ''] = t\n    const p = _p.replace(/\\/$/, '').trim()\n    const props = extractProps(p)\n    const item = {\n      props,\n      content: _c,\n    }\n    r.push(item)\n  }\n  return r\n}\n\nexport default extractTags\nexport { extractPropsSpec }","import { attributeRe } from './res'\n\nexport const getPropValue = (val) => {\n  if (val == 'true') return true\n  if (val == 'false') return false\n  if (/^\\d+$/.test(val)) {\n    return parseInt(val, 10)\n  }\n  return val\n}\n\n/**\n * Parse the arguments part of an XML element\n * @param {string} string String to extract attributes from.\n * @param {boolean} parseValue Parse `true` and `false` values into a boolean, and numbers into integers. Default `true`.\n */\nexport const extractProps = (string, parseValue = true) => {\n  const o = {}\n  const re = new RegExp(`\\\\s+${attributeRe.source}`, 'gu')\n  ;` ${string}`.replace(re, (match, name,  doubleQuoteVal, singleQuoteVal) => {\n    const value = singleQuoteVal || doubleQuoteVal\n    const v = value === undefined ? true : value\n    const val = parseValue ? getPropValue(v) : v\n    o[name] = val\n  })\n  return o\n}\n","export default stream\nexport const {\n  Duplex,\n  PassThrough,\n  Readable,\n  Stream,\n  Transform,\n  Writable,\n} = stream","export function checkRule(reObject) {\n  if (typeof reObject != 'object') {\n    return false\n  }\n  const { re, replacement } = reObject\n  const hasRe = re instanceof RegExp\n  const type = ['string', 'function'].indexOf(typeof replacement) != -1\n  return hasRe && type\n}\n\nexport const hideStack = (commonError, thrownError) => {\n  if (!(thrownError instanceof Error)) throw thrownError\n  const [, , commonLine] = commonError.stack.split('\\n', 3)\n  const i = thrownError.stack.indexOf(commonLine)\n  if (i == -1) throw thrownError\n  const stack = thrownError.stack.substr(0, i - 1)\n  const li = stack.lastIndexOf('\\n')\n  thrownError.stack = stack.substr(0, li)\n  throw thrownError\n}","export default os\nexport const {\n  EOL,\n  arch,\n  constants,\n  cpus,\n  endianness,\n  freemem,\n  homedir,\n  hostname,\n  loadavg,\n  networkInterfaces,\n  platform,\n  release,\n  tmpdir,\n  totalmem,\n  type,\n  uptime,\n  userInfo,\n} = os","import { homedir } from 'os'\n\nconst extractPathRegex = /\\s+at.*(?:\\(|\\s)(.*)\\)?/\nconst pathRegex = /^(?:(?:(?:node|(?:internal\\/[\\w/]*|.*node_modules\\/(?:IGNORED_MODULES)\\/.*)?\\w+)\\.js:\\d+:\\d+)|native)/\n\nconst homeDir = homedir()\n\n/**\n * Remove internal Node.JS lines from the error stack traces.\n * @param {string} stack The error stack to update.\n * @param {!_cleanStack.Config} [options] Options for the program.\n * @param {boolean} [options.pretty=false] Replace the absolute path to the home directory with the `~`. Default `false`.\n * @param {!Array<string>} [options.ignoredModules=\"\uff3b'pirates'\uff3d\"] Which modules to ignore in the path. Default `\uff3b'pirates'\uff3d`.\n */\nconst cleanStack = (stack, options) => {\n  const {\n    pretty = false, ignoredModules = ['pirates'],\n  } = options || {}\n  const j = ignoredModules.join('|')\n  const re = new RegExp(pathRegex.source.replace('IGNORED_MODULES', j))\n\n  return stack.replace(/\\\\/g, '/')\n    .split('\\n')\n    .filter(x => {\n      const pathMatches = x.match(extractPathRegex)\n      if (pathMatches === null || !pathMatches[1]) {\n        return true\n      }\n\n      const match = pathMatches[1]\n\n      // Electron\n      if (match.includes('.app/Contents/Resources/electron.asar') ||\n        match.includes('.app/Contents/Resources/default_app.asar')) {\n        return false\n      }\n\n      return !re.test(match)\n    })\n    .filter(x => x.trim())\n    .map(x => {\n      if (pretty) {\n        return x.replace(extractPathRegex, (m, p1) => m.replace(p1, p1.replace(homeDir, '~')))\n      }\n\n      return x\n    })\n    .join('\\n')\n}\n\nexport default cleanStack\n\n/* documentary types/index.xml */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {_cleanStack.Config} Config Options for the program.\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {Object} _cleanStack.Config Options for the program.\n * @prop {boolean} [pretty=false] Replace the absolute path to the home directory with the `~`. Default `false`.\n * @prop {!Array<string>} [ignoredModules=\"\uff3b'pirates'\uff3d\"] Which modules to ignore in the path. Default `\uff3b'pirates'\uff3d`.\n */\n","const getLastItem = (array) => {\n  const item = array[array.length - 1]\n  return item\n}\nconst getItemsFrom = (array, from) => array.slice(from)\n\n/**\n * Get a segment of the stack string, defaults are from = 0 and oneLine = false.\n * @param {string} stack the stack string\n * @param {number} [from=0] index from which to slice from\n * @param {boolean} [oneLine=false] Whether just first line must be returned\n * @returns {string} A stack segment starting from the specified line.\n */\nexport const getStackSegment = (stack, from = 0, oneLine = false) => {\n  if (from === 0 && !oneLine) {\n    return stack\n  }\n  const splitStack = stack\n    .split('\\n', oneLine ? from + 1 : undefined)\n  if (oneLine) {\n    const line = getLastItem(splitStack)\n    return line\n  } else {\n    const items = getItemsFrom(splitStack, from)\n    return items.join('\\n')\n  }\n}\n\n/**\n * Get the stack trace part of when the erotic function was called. Disregards\n * first two lines.\n * @param {string} stack error's stack\n * @param {boolean} [transparent] trim the top line as well\n * @returns {string} A part of stack\n */\nexport const getEntryStack = (stack, transparent = false) => {\n  const stackSegment = getStackSegment(stack, 2 + (transparent ? 1 : 0))\n  return stackSegment\n}\n\n/**\n * Get stack line of where the callback was called.\n * @param {string} stack Stack string.\n * @returns {string} Stack line.\n */\nexport const getCalleeStackLine = (stack) => {\n  const calleeStackLine = getStackSegment(stack, 2, true)\n  return calleeStackLine\n}\n\nexport const getStackHeading = message => `Error: ${message}`\n\n/**\n * Extract caller from the function's `arguments`.\n * @param {Object} args arguments\n * @returns {!Function} The caller function from `arguments.callee.caller`.\n */\nexport const getCallerFromArguments = (args) => {\n  const { callee: { caller } } = args\n  return caller\n}","import cleanStack from '@artdeco/clean-stack'\nimport {\n  getCallerFromArguments, getCalleeStackLine, getStackHeading,\n} from './lib'\n\n/**\n * Create a callback.\n * @param {!Function} entryCaller The function which was called at entry.\n * @param {string} entryStack The first line of the error stack to be returned\n * @param {boolean} [shadow=false] Print only entry stack.\n */\nexport function makeCallback(entryCaller, entryStack, shadow = false) {\n  /**\n   * This callback should be called when an asynchronous error occurred.\n   * @param {(string|Error)} messageOrError A message string or an _Error_ object at the point of actual error.\n   * @returns {Error} An error with the updated stack which includes the callee.\n   */\n  function cb(messageOrError) {\n    const caller = getCallerFromArguments(arguments)\n    const { stack: errorStack } = new Error()\n    const calleeStackLine = getCalleeStackLine(errorStack)\n    const isError = messageOrError instanceof Error\n    const message = isError ? messageOrError.message : messageOrError\n\n    const stackHeading = getStackHeading(message)\n    const entryHasCallee = caller !== null && entryCaller === caller\n    const stackMessage = [\n      stackHeading,\n      ...(entryHasCallee || shadow ? [entryStack] : [\n        calleeStackLine,\n        entryStack,\n      ]),\n    ].join('\\n')\n\n    const stack = cleanStack(stackMessage)\n    const properties = { message, stack }\n    const e = isError ? messageOrError : new Error()\n\n    return /** @type {Error} */ (Object.assign(/** @type {!Object} */ (e), properties))\n  }\n\n  return cb\n}","import {\n  getEntryStack, getCallerFromArguments,\n} from './lib'\nimport { makeCallback } from './callback'\n\n/**\n * Returns a function to create an error with a stack trace starting at the line in code when the call was made by the callee.\n * @param {boolean} [transparent] Pretend as if the call to the function lead to the error, without exposing any of the internal stack.\n */\nexport default function erotic(transparent) {\n  const { stack } = new Error()\n  const caller = getCallerFromArguments(arguments)\n  const entryStack = getEntryStack(stack, transparent)\n\n  return makeCallback(caller, entryStack, transparent)\n}","/**\n * Listens for the `error` event once so that when an error in _streamB_ is emitted, is is also emitted in the _streamA_.\n * @param {stream.Stream} streamA The stream that will emit an error once it's caught in the `streamB`.\n * @param {stream.Stream} streamB The stream from which the error originates.\n * @returns The stream the error is listened on, i.e., transparent to calling the `.once` method on that stream.\n */\nexport const pipeError = (streamA, streamB) => {\n  streamB\n    .once('error', e => {\n      streamA.emit('error', e)\n    })\n  return streamB\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('stream').Stream} stream.Stream\n */","import { Writable } from 'stream'\nimport erotic from 'erotic'\nimport cleanStack from '@artdeco/clean-stack'\nimport { pipeError } from './lib'\n\nfunction joinBufferData(array) {\n  return array.join('')\n}\n\n/**\n * A writable stream which collects incoming data into memory, and provides a promise to way for the stream to finish. The promise is resolved with joined chunks.\n */\nexport default class Catchment extends Writable {\n  /**\n   * Create a new catchment to pipe a readable stream into and collect all emitted data.\n   * @param {!_catchment.Options} [options] Options to pass to the `Writable` super constructor, and others shown below.\n   * @param {!stream.Readable} [options.rs] A readable stream to automatically pipe into the catchment. If an error occurs during reading of this stream, the catchment promise will be rejected with it.\n   * @param {boolean} [options.binary=false] Whether to return a raw buffer instead of a string. The string is created by joining all incoming chunks together with `.join('')` method. Default `false`.\n   * @example\n   *\n   * import { createReadStream } from 'fs'\n   * import Catchment from 'catchment'\n   *\n   * const rs = createReadStream('file.txt')\n   * const { promise } = new Catchment({ rs })\n   * const res = await promise\n   */\n  constructor(options) {\n    const {\n      binary = false, rs = null, ...opts\n    } = options || {}\n    /** @suppress {missingProperties} */\n    const { er = erotic(true), proxyError } = options || {}\n    const wrap = (_, e) => er(e)\n    super(/** @type {!stream.WritableOptions} */ (opts))\n    this._caughtData = []\n    this._promise = new Promise((r, j) => {\n      this.on('finish', () => {\n        let d\n        if (binary) {\n          d = Buffer.concat(this._caughtData)\n        } else {\n          d = joinBufferData(this._caughtData)\n        }\n        r(d)\n        this._caughtData = []\n      })\n      this.once('error', (e) => {\n        if (e.stack.indexOf('\\n') == -1) {\n          wrap`${e}`\n          j(e)\n        } else {\n          const stack = cleanStack(e.stack)\n          e.stack = stack\n          if (proxyError) wrap`${e}`\n          j(e)\n        }\n      })\n      if (rs) {\n        pipeError(this, rs).pipe(this)\n      }\n    })\n  }\n  _write(chunk, encoding, callback) {\n    this._caughtData.push(chunk)\n    callback()\n  }\n  /**\n   * A promise which will resolve will all data when the stream finishes.\n   * @type {Promise<string|Buffer>}\n   */\n  get promise() {\n    return this._promise\n  }\n}\n\n/**\n * Collect data into a catchment, and return results when the stream finishes.\n * @param {stream.Readable} readable A readable stream to collect all data from. If an error occurs during reading of this stream, the promise will be rejected with it.\n * @param {_catchment.CollectOptions} options Options when collecting data into a catchment. They can extend `Writable` options which will be passed to the `Catchment` constructor.\n * @param {boolean} [options.binary=false] Whether to return a raw buffer instead of a string. The string is created by joining all incoming chunks together with `.join('')` method. Default `false`.\n * @param {boolean} [options.proxyError=false] Sets whether an error emitted by the stream with have its stack start at the line where the `collect` was called rather than inside of the stream. In other words, hides the implementation of the stream. Default `false`.\n * @example\n *\n * import { collect } from 'catchment'\n * import { createReadStream } from 'fs'\n *\n * const rs = createReadStream(path)\n * await collect(rs, { proxyError: true })\n */\nexport const collect = async (readable, options = {}) => {\n  const { promise } = new Catchment({\n    rs: readable,\n    ...options,\n    er: erotic(true),\n  })\n  const res = await promise\n  return res\n}\n\n/* typal types/index.xml */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {_catchment.Options} Options Options to pass to the `Writable` super constructor, and others shown below.\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {Object} _catchment.Options Options to pass to the `Writable` super constructor, and others shown below.\n * @prop {!stream.Readable} [rs] A readable stream to automatically pipe into the catchment. If an error occurs during reading of this stream, the catchment promise will be rejected with it.\n * @prop {boolean} [binary=false] Whether to return a raw buffer instead of a string. The string is created by joining all incoming chunks together with `.join('')` method. Default `false`.\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('stream').Readable} stream.Readable\n */\n\n/* typal types/collect.xml */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {_catchment.CollectOptions} CollectOptions Options when collecting data into a catchment. They can extend `Writable` options which will be passed to the `Catchment` constructor.\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {Object} _catchment.CollectOptions Options when collecting data into a catchment. They can extend `Writable` options which will be passed to the `Catchment` constructor.\n * @prop {boolean} [binary=false] Whether to return a raw buffer instead of a string. The string is created by joining all incoming chunks together with `.join('')` method. Default `false`.\n * @prop {boolean} [proxyError=false] Sets whether an error emitted by the stream with have its stack start at the line where the `collect` was called rather than inside of the stream. In other words, hides the implementation of the stream. Default `false`.\n */\n","import Stream, { Transform } from 'stream'\nimport cleanStack from '@artdeco/clean-stack'\nimport { collect } from 'catchment'\nimport { checkRule, hideStack } from './lib'\n\nexport default class Replaceable extends Transform {\n  /**\n   * Replaceable class that extends Transform and pushes data when it's done replacing each incoming chunk. If the replacement is passed as a function, it will work in the same way as the replacer for `string.replace` method (https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace), taking the `match` as the first argument, and matched `p1`, `p2`, _etc_ parameters as following arguments. The replacer can also be an async function.\n   * @param {!(_restream.Rule|Array<!_restream.Rule>)} rules A single replacement rule, or multiple rules.\n   * @param {!stream.TransformOptions} [options] The options for the transform stream.\n   * @example\n   *\n```\n// markdown __ to html <em> implementation\nconst stream = replaceStream({\n  re: /__(\\S+)__/g,\n  replacement(match, p1) {\n    return `<em>${p1}</em>`\n  },\n})\n```\n   */\n  constructor(rules, options) {\n    super(options)\n    const re = Array.isArray(rules) ? rules : [rules]\n    const fr = re.filter(checkRule)\n    this.rules = fr\n    /**\n     * Whether the _Replaceable_ will not apply any more rules.\n     * @type {boolean}\n     */\n    this._broke = false\n    this._options = options\n  }\n\n  /**\n   * Creates a new replaceable to replace the given string, buffer or stream using the rules of the current stream. Calling `brake` will also set `_broke` on the parent stream.\n   * @param {string|!Buffer|!Stream} input The input to replace.\n   * @param {!Object} [context] The context to assign to the new replaceable.\n   */\n  async replace(input, context) {\n    const replaceable = new Replaceable(this.rules, this._options)\n    if (context) Object.assign(replaceable, context)\n    const res = await Replaceable.replace(replaceable, input)\n    if (replaceable._broke) this.brake()\n    if (context) Object.keys(context).forEach(key => {\n      context[key] = replaceable[key]\n    })\n    return res\n  }\n  /**\n   * The method to end the stream with given data, and collect the result.\n   * @param {!Replaceable} replaceable\n   * @param {string|!Buffer|!Stream} input The data or stream to end the _Replaceable_ with.\n   */\n  static async replace(replaceable, input) {\n    return replace(replaceable, input)\n  }\n\n  /**\n   * Stop executing further after the current rule.\n   */\n  brake() {\n    this._broke = true\n  }\n\n  /**\n   * @param {string|!Buffer} chunk The incoming chunk, or an object if the stream was started in object mode.\n   */\n  async reduce(chunk) {\n    /** @type {string} */\n    const s = await this.rules.reduce(async (acc, { re, replacement }) => {\n      /** @type {string} */\n      let string = await acc\n      if (this._broke) return string\n\n      if (typeof replacement == 'string') {\n        string = string.replace(re, replacement)\n      } else {\n        const promises = []\n        let commonError\n        const t = string.replace(re, (match, ...args) => {\n          commonError = new Error()\n          try {\n            if (this._broke) {\n              if (promises.length)\n                return promises.push(Promise.resolve(match))\n              return match\n            }\n            const p = replacement.call(this, match, ...args)\n            if (p instanceof Promise) {\n              promises.push(p)\n            }\n            return p\n          } catch (e) { // hide stack for sync stack traces\n            hideStack(commonError, e)\n          }\n        })\n        if (promises.length) {\n          try { // hide stack only for when throw happens before awaits\n            const data = await Promise.all(promises)\n            string = string.replace(re, () => data.shift())\n          } catch (e) {\n            hideStack(commonError, e)\n          }\n        } else {\n          string = t\n        }\n      }\n      return string\n    }, `${chunk}`)\n\n    return s\n  }\n  /**\n   * @suppress {checkTypes}\n   * @returns {!Promise}\n   */\n  async _transform(chunk, _, next) {\n    try {\n      const s = await this.reduce(chunk)\n      this.push(s)\n      next()\n    } catch (e) {\n      const s = cleanStack(e.stack)\n      e.stack = s\n      next(e)\n    }\n  }\n}\n\n/**\n * The method to end the stream with given data, and collect the result.\n * @param {!Replaceable} replaceable\n * @param {string|!Buffer|!Stream} input The data or stream to end the _Replaceable_ with.\n */\nexport async function replace(replaceable, input) {\n  if (input instanceof Stream) {\n    input.pipe(replaceable)\n  } else {\n    replaceable.end(input)\n  }\n  /** @type {string} */\n  const data = await collect(replaceable)\n  return data\n}\n\n/**\n * The class for when serial execution of asynchronous replacements withing the same rule are needed.\n */\nexport class SerialAsyncReplaceable extends Replaceable {\n  /**\n   * @param {!(_restream.Rule|Array<!_restream.Rule>)} rules\n   */\n  constructor(rules) {\n    super(rules)\n    this.promise = Promise.resolve()\n  }\n  addItem(fn) {\n    const pp = this.promise.then(fn)\n    this.promise = pp\n    return pp\n  }\n}\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('.').Rule} _restream.Rule\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('.').AsyncReplacer} _restream.AsyncReplacer\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('.').Replacer} _restream.Replacer\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('stream').TransformOptions} stream.TransformOptions\n */","import makeIo from './lib/make-io'\n\nconst makeProps = (props) => {\n  const keys = Object.keys(props)\n  return `{\n    ${keys.map((key) => {\n    const k = /-/.test(key) ? `'${key}'` : key\n    return `${k}: '${props[key]}'`\n  }).join(',\\n')}${keys.length ? ',' : ''}\n  }`\n}\n\n/**\n * @param {!_competent.ExportedComponent} component\n */\nconst makeComponent = (component) => {\n  const arr = []\n  arr.push(`key: '${component.key}'`)\n  arr.push(`id: '${component.id}'`)\n  if (Object.keys(component.props).length)\n    arr.push(`props: ${makeProps(component.props)}`)\n  const c = component.children.filter(Boolean)\n  if (c.length)\n    arr.push(`children: ${JSON.stringify(component.children)}`)\n  const j = arr.map((l) => `  ${l}`).join(',\\n') + ','\n  return `{\n${j}\n}`\n}\n\n/**\n * @param {!Array<!_competent.ExportedComponent>} components\n */\nconst makeJs = (components) => {\n  const s = components.map(makeComponent)\n  return '[' + s.join(',\\n') + ']'\n}\n\nconst defineIo = (io = true) => {\n  if (!io) return ''\n  return `${makeIo}\nconst io = makeIo(${typeof io == 'string' ? `'${io}'` : ''});`\n}\n\n/**\n * From the array of exported components, creates an ES6 modules script that will render them on a page using Preact.\n * @param {!Array<!_competent.ExportedComponent>} components The list of exported components\n * @param {string} componentsLocation The location of the module which exports a default object with components relative to where this file will be placed.\n * @param {boolean} [includeH=false] Imports the `h` pragma from preact. By default is disabled, because can be added automatically by `Depack` and `@idio/frontend`.\n * @param {!Object} [props] Properties.\n * @param {boolean|string} [io=false] Should the generated script use the intersection observer. When a string is passed, it is used as the root margin option (default is, `0px 0px 76px 0px`)\n */\nconst makeComponentsScript = (components, componentsLocation, includeH = false, props = {}, io = false ) => {\n  const p = Object.keys(props).map((propName) => {\n    const val = props[propName]\n    const s = `props.${propName} = ${val}`\n    return s\n  }).join('\\n')\n  const r = 'render(h(Comp, props, children), parent, el)'\n  const ifIo = io ? `el.render = () => {\n      ${r}\n    }\n    el.render.meta = { key, id }\n    io.observe(el)` : r\n  const s = `import { render${includeH ? ', h' : ''} } from 'preact'\n`+`import Components from '${componentsLocation}'\n\n${defineIo(io)}${makeJs(components)}\n  .map(({ key, id, props = {}, children }) => {\n    const el = document.getElementById(id)\n    if (!el) {\n      console.warn('Parent element for component %s with id %s not found', key, id)\n      return\n    }\n    const parent = el.parentElement\n    if (!parent) {\n      console.warn('Parent of element for component %s with id %s not found', key, id)\n      return\n    }\n    const Comp = Components[key]\n    if (!Comp) {\n      console.warn('Component with key %s was not found.', key)\n      return\n    }\n${p ? `    ${p}` : ''}\n    ${ifIo}\n  })\n`\n  return s\n}\n\n// render(h(Comp, props, children), parent, el)\n\nexport default makeComponentsScript\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').ExportedComponent} _competent.ExportedComponent\n */","// export default function makeIo(rootMargin = '0px 0px 76px 0px') {\n//   const io = new IntersectionObserver((entries) => {\n//     entries.forEach(({ target, isIntersecting }) => {\n//       if (isIntersecting) {\n//         if (target.render) {\n//           console.warn('rendering component %s into the element %s ',\n//             target.render.meta.key, target.render.meta.id)\n//           target.render()\n//           io.unobserve(target)\n//         }\n//       }\n//     })\n//   }, { rootMargin })\n//   return io\n// }\n\nexport default `function makeIo(rootMargin = '0px 0px 76px 0px') {\n  const io = new IntersectionObserver((entries) => {\n    entries.forEach(({ target, isIntersecting }) => {\n      if (isIntersecting) {\n        if (target.render) {\n          console.warn('rendering component %s into the element %s ',\n            target.render.meta.key, target.render.meta.id)\n          target.render()\n          io.unobserve(target)\n        }\n      }\n    })\n  }, { rootMargin })\n  return io\n}`","import '@externs/preact' // can't set that in @depack/render's package.json yet\nimport '../types/externs'\nimport competent, { makeComponentsScript } from './'\n\nmodule.exports = {\n  '_competent': competent,\n  '_makeComponentsScript': makeComponentsScript,\n}","import render from '@depack/render'\nimport rexml from 'rexml'\nimport { Replaceable } from 'restream'\nimport { makeRe } from './lib'\n\n/**\n * Extracts, Renders And Exports For Dynamic Render JSX Components From Within HTML.\n * @param {!Object<string, function({ children: !Array<string> })>} components The components to look for and render.\n * @param {!_competent.Config} [conf] Options for the program. All functions will be called with the Replaceable instance as their `this` context.\n */\nconst competent = (components, conf = {}) => {\n  const { getId, getProps = (props, meta) => ({\n    ...props, ...meta }), markExported, onSuccess, onFail,\n  removeOnError = false, getContext, getReplacements } = conf\n\n  const re = makeRe(Object.keys(components))\n\n  /** @type {!_restream.AsyncReplacer} */\n  const replacement = async function (m, pad, Component, key, position, str) {\n    try {\n      const instance = components[key]\n      const before = str.slice(0, position)\n      const after = str.slice(position + m.length)\n      if (/\u003c!--\\s*$/.test(before) && /^\\s*--\u003e/.test(after))\n        return m\n\n      // let initialPadding = 0\n      // const lastNewLine = before.lastIndexOf('\\n')\n      // if (lastNewLine != -1) initialPadding = position - lastNewLine - 1\n      // else initialPadding = position\n\n      const [{ content = '', props: htmlProps }] = rexml(key, Component)\n      let child = content\n\n      const children = [child]\n      let exported = false\n      let renderAgain = true\n      let recursiveRenderAgain = false\n      let pretty, lineLength\n      let id\n      const props = getProps.call(this, {\n        ...htmlProps,\n        children,\n      }, /** @type {!_competent.Meta} */ ({\n        export(value = true) { exported = value },\n        setPretty(p, l) { pretty = p; if (l) lineLength = l },\n        renderAgain(v = false) { renderAgain = true, recursiveRenderAgain = v },\n      }), key)\n      /** @type {preact.VNode} */\n      let hyperResult\n      try {\n        const promise = instance(props)\n        hyperResult = await promise\n      } catch (err) {\n        if (!err.message.startsWith('Class constructor'))\n          throw err\n        const Instance = /** @type {function(new:preact.Component)} */ (instance)\n        const i = new Instance()\n        hyperResult = i.render(props)\n      }\n      if (exported && !hyperResult.attributes.id) {\n        id = getId.call(this) // `c${splendid.random()}`\n        hyperResult.attributes.id = id\n      }\n      const renderOptions = {\n        pretty,\n        lineLength,\n      }\n      let r\n      if (typeof hyperResult == 'string') {\n        r = hyperResult\n      } else if (Array.isArray(hyperResult)) {\n        r = hyperResult.map((hr) => {\n          if (typeof hr == 'string') return hr\n          const res = render(hr, renderOptions)\n          return res\n        }).join('\\n')\n      } else {\n        r = render(hyperResult, renderOptions)\n      }\n      r = r.replace(/^/gm, pad)\n      if (renderAgain) { // new v render again by default\n        let childRules\n        if (getReplacements) {\n          childRules = getReplacements.call(this, key, recursiveRenderAgain)\n        } else {\n          childRules = {\n            re: new RegExp(re.source.replace(new RegExp(`(\\\\|)?${key}(\\\\|)?`),\n              (_, pb, pa) => {\n                if (pb && pa) return '|'\n                return ''\n              }), re.flags),\n            replacement,\n          }\n        }\n        const childRepl = new Replaceable(childRules)\n        if (getContext) {\n          const ctx = getContext.call(this)\n          Object.assign(childRepl, ctx)\n        }\n        r = await Replaceable.replace(childRepl, r)\n      }\n      if (exported)\n        markExported.call(this, key, hyperResult.attributes.id, htmlProps, children)\n      if (onSuccess) onSuccess.call(this, key)\n      return r\n    } catch (err) {\n      if (onFail) onFail.call(this, key, err, position, str)\n      if (removeOnError) return ''\n      return m\n    }\n  }\n  /** @type {_restream.Rule} */\n  const rule = {\n    re, replacement,\n  }\n  return rule\n}\n\nexport default competent\nexport { default as makeComponentsScript } from './make-comps'\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('restream').Rule} _restream.Rule\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('restream').AsyncReplacer} _restream.AsyncReplacer\n */\n\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').Config} _competent.Config\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').Meta} _competent.Meta\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').VNode} preact.VNode\n */\n/**\n * @suppress {nonStandardJsDocs}\n * @typedef {import('..').Component} preact.Component\n */\n","export const makeRe = (keys) => {\n  const k = `(${keys.join('|')})`\n  const s = '(?:\\\\s+(?!\\\\/>)[^>]*?)?' // before closing >\n  const re = new RegExp(`( *)(<${k}${s}(?:\\\\s*?/>|>[\\\\s\\\\S]*?<\\\\/\\\\3>))`, 'gm')\n  return re\n}"],
"names":["IS_NON_DIMENSIONAL","encodeEntities","s","replace","isLargeString","length","indexOf","JS_TO_CSS","getNodeProps","vnode","props","attributes","children","defaultProps","nodeName","undefined","i","mapAttributes","allAttributes","xml","isSvgMode","sort","selectValue","html","attrs","Object","keys","mappedAttributes","map","name","v","match","includes","class","for","srcset","toLowerCase","str","prop","val","test","__html","filter","a","Boolean","UNNAMED","VOID_ELEMENTS","INLINE_ELEMENTS","render","config","addDoctype","pretty","res","renderToString","context","opts","inner","shallow","renderRootComponent","shallowHighOrder","sortAttributes","initialPadding","closeVoidTags","lineLength","noPretty","ip","repeat","indentChar","prototype","c","_disable","__x","getDerivedStateFromProps","state","componentWillMount","rendered","getChildContext","displayName","Function","getFallbackComponentName","cl","nl","reduce","acc","current","newLength","join","isVoid","pieces","getLastLineLength","hasLarge","child","ret","childSvgMode","substring","lastPiece","component","toString","call","index","push","st","split","lastLine","mismatch","re","string","m","args","o","slice","p","capturedGroup","key","start","attributeRe","RegExp","nameRe","source","valRe","attributesRe","extractTags","tag","matches","Array","isArray","tags","t","simple","end1","end2","tagName","content","trim","extractProps","simpleAttribute","parseInt","$jscompDefaultExport","stream","Transform","Writable","checkRule","reObject","replacement","hasRe","type","hideStack","commonError","thrownError","Error","commonLine","stack","substr","li","lastIndexOf","homedir","os","extractPathRegex","pathRegex","homeDir","cleanStack","ignoredModules","j","x","pathMatches","p1","getStackSegment","from","oneLine","splitStack","item","items","getEntryStack","transparent","stackSegment","getCallerFromArguments","caller","makeCallback","entryCaller","entryStack","shadow","cb","messageOrError","arguments","errorStack","calleeStackLine","message","isError","stackMessage","stackHeading","assign","e","properties","erotic","pipeError","streamA","streamB","once","emit","Catchment","options","binary","rs","er","proxyError","wrap","_","_caughtData","_promise","Promise","r","on","d","Buffer","concat","pipe","chunk","encoding","callback","collect","readable","promise","replaceable","input","Replaceable","rules","fr","_broke","_options","Replaceable$$module$node_modules$restream$src$Replaceable.replace","brake","forEach","promises","resolve","data","all","shift","next","Stream","end","makeProps","k","makeComponent","arr","id","JSON","stringify","l","defineIo","io","makeIo","module","exports","components","conf","competent","pad","Component","position","instance","before","after","htmlProps","exported","renderAgain","recursiveRenderAgain","getProps","export","value","setPretty","hyperResult","err","startsWith","getId","renderOptions","hr","childRules","getReplacements","pb","pa","flags","childRepl","getContext","ctx","markExported","onSuccess","onFail","removeOnError","meta","rule","componentsLocation","includeH","makeComponentsScript","propName","ifIo"]
}
